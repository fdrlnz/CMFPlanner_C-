<UserControl x:Class="CMFPlanner.UI.TriplanarViewer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helix="http://helix-toolkit.org/wpf"
             Background="#0D0D0D">

    <UserControl.Resources>
        <Style x:Key="PresetBtn" TargetType="Button">
            <Setter Property="Background"      Value="#2D2D2D"/>
            <Setter Property="Foreground"      Value="#AAAAAA"/>
            <Setter Property="BorderBrush"     Value="#3E3E42"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"         Value="6,3"/>
            <Setter Property="Margin"          Value="2,0"/>
            <Setter Property="FontSize"        Value="10"/>
            <Setter Property="Cursor"          Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#3E3E42"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#0078D4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <!-- 3-row × 3-col grid: content / 2px separator / content -->
    <Grid x:Name="ViewportGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="2"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="2"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Separators -->
        <Rectangle x:Name="HSeparator"
                   Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                   Fill="#3E3E42"/>
        <Rectangle x:Name="VSeparator"
                   Grid.Row="0" Grid.Column="1" Grid.RowSpan="3"
                   Fill="#3E3E42"/>

        <!-- ══ AXIAL  (top-left) ══════════════════════════════════════ -->
        <Border x:Name="AxialBorder" Grid.Row="0" Grid.Column="0" ClipToBounds="True">
            <Grid>
                <Viewbox Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Grid x:Name="AxialGrid" Width="1" Height="1" Background="Black"
                          Cursor="Cross"
                          MouseLeftButtonDown="AxialGrid_MouseLeftButtonDown"
                          MouseMove="AxialGrid_MouseMove"
                          MouseRightButtonDown="AnyGrid_RightButtonDown"
                          MouseRightButtonUp="AnyGrid_RightButtonUp"
                          MouseWheel="AxialGrid_MouseWheel">
                        <Grid.ContextMenu><x:Null/></Grid.ContextMenu>
                        <Image x:Name="AxialImage" Stretch="Fill"
                               RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                        <Canvas x:Name="AxialGridCanvas" Width="1" Height="1" IsHitTestVisible="False"/>
                        <Canvas x:Name="AxialCanvas" Width="1" Height="1" IsHitTestVisible="False">
                            <Line x:Name="AxialHLine" Stroke="#44BB44" StrokeThickness="0.8"/>
                            <Line x:Name="AxialVLine" Stroke="#FF8800" StrokeThickness="0.8"/>
                        </Canvas>
                    </Grid>
                </Viewbox>
                <Border Background="#55000000" HorizontalAlignment="Left" VerticalAlignment="Top"
                        Padding="5,2" Margin="4" IsHitTestVisible="False">
                    <TextBlock Text="AXIAL" Foreground="#44BB44" FontSize="10" FontWeight="SemiBold"/>
                </Border>
            </Grid>
        </Border>

        <!-- ══ CORONAL  (top-right) ══════════════════════════════════ -->
        <Border x:Name="CoronalBorder" Grid.Row="0" Grid.Column="2" ClipToBounds="True">
            <Grid>
                <Viewbox Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Grid x:Name="CoronalGrid" Width="1" Height="1" Background="Black"
                          Cursor="Cross"
                          MouseLeftButtonDown="CoronalGrid_MouseLeftButtonDown"
                          MouseMove="CoronalGrid_MouseMove"
                          MouseRightButtonDown="AnyGrid_RightButtonDown"
                          MouseRightButtonUp="AnyGrid_RightButtonUp"
                          MouseWheel="CoronalGrid_MouseWheel">
                        <Grid.ContextMenu><x:Null/></Grid.ContextMenu>
                        <Image x:Name="CoronalImage" Stretch="Fill"
                               RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                        <Canvas x:Name="CoronalGridCanvas" Width="1" Height="1" IsHitTestVisible="False"/>
                        <Canvas x:Name="CoronalCanvas" Width="1" Height="1" IsHitTestVisible="False">
                            <Line x:Name="CoronalHLine" Stroke="#4488FF" StrokeThickness="0.8"/>
                            <Line x:Name="CoronalVLine" Stroke="#FF8800" StrokeThickness="0.8"/>
                        </Canvas>
                    </Grid>
                </Viewbox>
                <Border Background="#55000000" HorizontalAlignment="Left" VerticalAlignment="Top"
                        Padding="5,2" Margin="4" IsHitTestVisible="False">
                    <TextBlock Text="CORONAL" Foreground="#4488FF" FontSize="10" FontWeight="SemiBold"/>
                </Border>
            </Grid>
        </Border>

        <!-- ══ SAGITTAL  (bottom-left) ══════════════════════════════ -->
        <Border x:Name="SagittalBorder" Grid.Row="2" Grid.Column="0" ClipToBounds="True">
            <Grid>
                <Viewbox Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Grid x:Name="SagittalGrid" Width="1" Height="1" Background="Black"
                          Cursor="Cross"
                          MouseLeftButtonDown="SagittalGrid_MouseLeftButtonDown"
                          MouseMove="SagittalGrid_MouseMove"
                          MouseRightButtonDown="AnyGrid_RightButtonDown"
                          MouseRightButtonUp="AnyGrid_RightButtonUp"
                          MouseWheel="SagittalGrid_MouseWheel">
                        <Grid.ContextMenu><x:Null/></Grid.ContextMenu>
                        <Image x:Name="SagittalImage" Stretch="Fill"
                               RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                        <Canvas x:Name="SagittalGridCanvas" Width="1" Height="1" IsHitTestVisible="False"/>
                        <Canvas x:Name="SagittalCanvas" Width="1" Height="1" IsHitTestVisible="False">
                            <Line x:Name="SagittalHLine" Stroke="#4488FF" StrokeThickness="0.8"/>
                            <Line x:Name="SagittalVLine" Stroke="#44BB44" StrokeThickness="0.8"/>
                        </Canvas>
                    </Grid>
                </Viewbox>
                <Border Background="#55000000" HorizontalAlignment="Left" VerticalAlignment="Top"
                        Padding="5,2" Margin="4" IsHitTestVisible="False">
                    <TextBlock Text="SAGITTAL" Foreground="#FF8800" FontSize="10" FontWeight="SemiBold"/>
                </Border>
            </Grid>
        </Border>

        <!-- ══ 3D BONE PREVIEW  (bottom-right) ═══════════════════════════ -->
        <Border x:Name="InfoBorder" Grid.Row="2" Grid.Column="2" ClipToBounds="True"
                Background="#111111">
            <Grid PreviewMouseLeftButtonDown="Preview3D_PreviewMouseLeftButtonDown">

                <!-- HelixViewport3D — bone preview -->
                <helix:HelixViewport3D x:Name="Preview3D"
                                       Background="#111111"
                                       ShowCoordinateSystem="False"
                                       ShowFrameRate="False"
                                       IsRotationEnabled="True"
                                       IsMoveEnabled="True"
                                       IsPanEnabled="True"
                                       IsZoomEnabled="True"
                                       RotateAroundMouseDownPoint="True"
                                       PreviewMouseRightButtonDown="Preview3D_PreviewMouseRightButtonDown"
                                       PreviewMouseRightButtonUp="Preview3D_PreviewMouseRightButtonUp"
                                       MouseMove="Preview3D_MouseMove">
                    <helix:HelixViewport3D.ContextMenu>
                        <x:Null/>
                    </helix:HelixViewport3D.ContextMenu>
                </helix:HelixViewport3D>

                <!-- No-mesh placeholder -->
                <TextBlock x:Name="NoMeshText"
                           Text="Apply segmentation&#10;to see 3D preview"
                           Foreground="#444444" FontSize="11"
                           TextAlignment="Center" LineHeight="20"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           IsHitTestVisible="False"/>

                <!-- Panel label -->
                <Border Background="#55000000" HorizontalAlignment="Left" VerticalAlignment="Top"
                        Padding="5,2" Margin="4" IsHitTestVisible="False">
                    <TextBlock Text="3D PREVIEW" Foreground="#FF8800" FontSize="10" FontWeight="SemiBold"/>
                </Border>

                <!-- W/L presets — compact overlay bottom of panel -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center" VerticalAlignment="Bottom"
                            Margin="0,0,0,6" IsHitTestVisible="True">
                    <Button Content="Soft Tissue" Style="{StaticResource PresetBtn}"
                            Click="BtnPresetSoftTissue_Click" ToolTip="W=400 L=40"/>
                    <Button Content="Bone" Style="{StaticResource PresetBtn}"
                            Click="BtnPresetBone_Click" ToolTip="W=2000 L=400"/>
                </StackPanel>

            </Grid>
        </Border>

    </Grid>
</UserControl>
